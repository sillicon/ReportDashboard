/*! qadashboard 2018-03-18 by sillicon */

window.onload=function(){let e=getTodayDate();"date"!=$("#testDate")[0].type?($("#testDate").datepicker(),$("#chooseDay").datepicker("option","maxDate",new Date)):document.querySelector("#testDate").max=e,document.querySelector("#testDate").value=e;for(var t=document.getElementById("envir1"),n=document.getElementById("browser"),o=["Envir1","Envir2","Envir3"],a=0;a<o.length;a++)t.options[a]=new Option(o[a],o[a]);var l=["Firefox","Chrome","IE 11","Safari-Desktop","Safari-iOS","IE 10","IE 9","IE 8","Other"];for(a=0;a<l.length;a++)n.options[a]=new Option(l[a],l[a]);document.querySelector("#envir1").addEventListener("change",function(){d()}),document.querySelectorAll("#sourceUpload,#testDate").forEach(function(e){e.addEventListener("change",function(){var e,t,n;e=document.getElementById("sourceUpload"),t=document.getElementById("testDate"),n=document.getElementById("submitBut"),e.files.length>0&&function(e){if(""==e)return!1;var t=new Date(e);return t>new Date("01/01/2015")&&t<=new Date}(t.value)?n.className=n.className.replace(/(?:^|\s)buttonDisabled(?!\S)/g,""):n.className.indexOf("buttonDisabled")<0&&(n.className+=" buttonDisabled")})}),document.querySelector("#submitBut").addEventListener("click",function(){var e,t,n,o;e="",t=document.getElementById("sourceUpload").files[0],n=new FileReader,(o=document.getElementById("resultInfo")).innerHTML='<div id ="loader" class="loader"></div>',o.style.display="block",n.onload=function(t){e=n.result;var a={reportDate:document.getElementById("testDate").value,reportEnvi:document.getElementById("envir1").value,reportHive:document.getElementById("envir2").value,reportBrowser:document.getElementById("browser").value,testID:document.getElementById("testName").value,reportName:document.getElementById("testName").options[document.getElementById("testName").selectedIndex].text.replace(/\s+/g,""),reportHTML:e};document.getElementById("switchCheckbox").checked?a.reportResult="Pass":a.reportResult="Fail";var l=new XMLHttpRequest;l.open("POST","./uploadReport"),l.setRequestHeader("Content-Type","application/json"),l.send(JSON.stringify(a)),l.onreadystatechange=function(){this.readyState==XMLHttpRequest.DONE&&200==this.status&&(o.innerHTML=this.responseText)}},n.readAsText(t)}),document.querySelector("#back").addEventListener("click",function(){location.href="home.html"});var r=new XMLHttpRequest;function d(){var e=document.getElementById("envir1"),t=document.getElementById("envir2"),n=2;t.length=0,2==e.selectedIndex&&(n=8);for(var o=0;o<n;o++)t.options[o]=new Option("hive "+o,"hive"+o)}r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText),t=document.createElement("select");t.id="testName",document.querySelector("#holderbox > table > tbody > tr:nth-child(4) > td:nth-child(2)").appendChild(t);for(var n=0;n<e.length;n++)if(null!=e[n].child){var o=document.createElement("optgroup");o.label=e[n].testName,t.appendChild(o);for(var a=[e[n]],l=[0];a.length>0;)if(l[l.length-1]<=a[a.length-1].child.length-1){for(var r="  ",d=0;d<l.length;d++)r+=r;(i=document.createElement("option")).text=r+a[a.length-1].child[l[l.length-1]].testName,i.value=a[a.length-1].child[l[l.length-1]].id,null!=a[a.length-1].child[l[l.length-1]].child?(i.disabled=!0,o.appendChild(i),a.push(a[a.length-1].child[l[l.length-1]]),l.push(0)):(o.appendChild(i),l[l.length-1]++)}else l.pop(),a.pop(),l[l.length-1]++}else{var i;(i=document.createElement("option")).text=e[n].testName,i.value=e[n]._id,t.appendChild(i)}}else 4==this.readyState&&(document.querySelector("#holderbox").innerHTML=this.responseText)},r.open("GET","./getTestName"),r.send(),d()};