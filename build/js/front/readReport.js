/*! qadashboard 2018-02-08 by sillicon */

function e(){location.href="home.html"}function t(){formDiv=document.getElementById("holderbox"),onDateRadio=document.getElementById("onDate"),testDate=document.getElementById("testDate"),dateRangeRadio=document.getElementById("dateRange"),dateRange1=document.getElementById("dateRange1"),dateRange2=document.getElementById("dateRange2"),withinDaysRadio=document.getElementById("onDays"),withinDays=document.getElementById("withinDays"),fileInput=document.getElementById("sourceUpload"),dateValue=document.getElementById("testDate"),subButton=document.getElementById("submitBut"),cateCheck=document.getElementById("categoryCheck"),cateSel=document.getElementById("caterogyList"),envir1Chb=document.getElementById("envir1Chb"),envir2Chb=document.getElementById("envir2Chb"),envir3Chb=document.getElementById("envir3Chb"),chartDiv=document.getElementById("charts"),resultDiv=document.getElementById("reportList"),isOpera=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox="undefined"!=typeof InstallTrigger,isSafari=/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari||safari.pushNotification).toString(),isIE=!!document.documentMode,isEdge=!isIE&&!!window.StyleMedia,isChrome=!!window.chrome&&!!window.chrome.webstore,isBlink=(isChrome||isOpera)&&!!window.CSS;for(var e=["Last 3 days","Last week","Last 2 weeks","Last 3 weeks","Last 4 weeks","All Records"],t=[3,7,14,21,28,-1],a=0;a<e.length;a++)withinDays.options[a]=new Option(e[a],t[a]);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){"date"!=$("#testDate")[0].type&&($("#testDate").datepicker(),$("#dateRange1").datepicker(),$("#dateRange2").datepicker()),document.querySelector("body").addEventListener("click",function(e){"rect"!=e.target.tagName&&(document.querySelector("#testListTip").style.display="none")});var e=JSON.parse(this.responseText),t=document.querySelector("#multi-select div.menu"),a=Object.keys(e);for(let s=0;s<a.length;s++)if(["30","31"].indexOf(a[s])<0){var n=document.createElement("div");n.className="item",n.setAttribute("data-value",a[s]),n.textContent=e[a[s]],t.appendChild(n)}if($("#multi-select").dropdown(),window.location.href.indexOf("?")>-1){var i=o(window.location.href);"Date"==i.requestType?(onDateRadio.checked=!0,testDate.value=i.reportDate):"Range"==i.requestType&&("null"!=i.startDate?(dateRangeRadio.checked=!0,dateRange1.value=i.startDate,dateRange2.value=i.endDate,m()):(withinDaysRadio.checked=!0,withinDays.selectedIndex=withinDays.childElementCount-1)),i.hasOwnProperty("reportCategory")&&(cateCheck.checked=!0,f(),$("#multi-select").dropdown("set selected",i.reportCategory.split(","))),i.reportEnvir1&&(envir1Chb.checked=!0),i.reportEnvir2&&(envir2Chb.checked=!0),i.reportEnvir3&&(envir3Chb.checked=!0),s(i)}f(),p()}else 4==this.readyState&&(document.querySelector("#holderbox").innerHTML=this.responseText,document.querySelector("#reportList").innerHTML=this.responseText)},n.open("GET","./getIDRef"),n.send()}function a(){}function n(){var e,t={reportEnvir1:envir1Chb.checked,reportEnvir2:envir2Chb.checked,reportEnvir3:envir3Chb.checked};onDateRadio.checked?(t.requestType="Date",t.reportDate=testDate.value):(t.requestType="Range",dateRange.checked?(t.startDate=dateRange1.value,t.endDate=dateRange2.value):(withinDays.value>0?((e=new Date).setDate(e.getDate()-withinDays.value),t.startDate=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()):t.startDate=null,e=new Date,t.endDate=e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear())),cateCheck.checked&&(t.reportCategory=document.querySelector("#cateValue").value),s(t),history.pushState(null,null,l(t))}function s(e){var t=document.createElement("button");t.textContent="Back",t.id="backToForm",t.addEventListener("click",function(){if("none"===formDiv.style.display){var t=document.getElementById("backToForm"),a=document.getElementById("charts");t.outerHTML="",h(formDiv),u(resultDiv),window.setTimeout(function(){a.innerHTML="",document.getElementById("tooltip").style.opacity=0},400),e.hasOwnProperty("reportEnvir1")&&e.reportEnvir1?envir1Chb.checked=!0:envir1Chb.checked=!1}}),formDiv.parentNode.insertBefore(t,formDiv.nextSibling),t.className="navigation",u(formDiv),h(resultDiv),resultDiv.innerHTML='<div id ="loader" class="loader"></div>';var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState&&200===this.status){for(var e=JSON.parse(this.responseText),t=0,a=[{name:"Envir1"},{name:"Envir2"},{name:"Envir3"}],n=0;n<e.length;n++)e[n].length>0&&(t+=1,d(e[n],a[n].name));if(0===t)resultDiv.style.textAlign="Center",resultDiv.innerHTML="<font size = '10px'>No Records Found!</font>";else{1===t?resultDiv.style.width="40%":2===t?(resultDiv.style.width="60%",resultDiv.style.minWidth="400px"):3===t&&(resultDiv.style.width="90%",resultDiv.style.minWidth="550px");var s='<table style= "width: 100%; margin: auto" class = "masterTable"><tr>';for(n=0;n<e.length;n++)e[n].length>0&&(s+="<th>"+e[n][0].envirTested+"</th>");s+="</tr><tr>";for(n=0;n<e.length;n++)e[n].length>0&&(s+="<td>"+c(e[n])+"</td>");s+="</tr></table>",resultDiv.innerHTML=s}resultDiv.style.display="block"}else 400===this.status&&(resultDiv.style.textAlign="Center",resultDiv.innerHTML="<font size = '10px'>"+this.responseText+"</font>")},a.open("GET","./queryReports"+l(e)),a.send()}function i(){(envir1Chb.checked||envir2Chb.checked||envir3Chb.checked)&&(!cateCheck.checked||cateCheck.checked&&""!=document.querySelector("#cateValue").value)&&(onDateRadio.checked&&""!==testDate.value||dateRangeRadio.checked&&r(dateRange1.value)&&r(dateRange2.value)&&new Date(dateRange1.value)<=new Date(dateRange2.value)||withinDaysRadio.checked)?subButton.className=subButton.className.replace(/(?:^|\s)buttonDisabled(?!\S)/g,""):subButton.className.indexOf("buttonDisabled")<0&&(subButton.className+=" buttonDisabled")}function r(e){var t=new Date(e);return!isNaN(t)}function l(e){return"?"+Object.keys(e).map(function(t){return t+"="+e[t]}).join("&")}function o(e){for(var t={},a=e.split("?")[1].split("&"),n=0;n<a.length;n++){var s=a[n].split("=")[0],i=decodeURI(a[n].split("=")[1]);t[s]="true"===i||"false"!==i&&i}return t}function d(e,t){d3.select("#charts").append("span").html("<b>"+t+"</b>");for(var a=[],n=[],s=[],i=[],r=[],l=0,o=0,d=0,c=0;c<e.length;c++)"Pass"===e[c].testResult?(o+=1,i.push(e[c].fileName)):(d+=1,r.push(e[c].fileName)),c<e.length-1?e[c].testID!==e[c+1].testID?(l=o/(o+d),n.push({date:e[c].testDate,ratio:l,counts:o+d,testName:e[c].testName,passFiles:i,failFiles:r}),i=[],r=[],o=0,d=0,s.push(n),a.push(e[c].testName),n=[]):e[c].testDate!=e[c+1].testDate&&(l=o/(o+d),n.push({date:e[c].testDate,ratio:l,counts:o+d,testName:e[c].testName,passFiles:i,failFiles:r}),i=[],r=[],o=0,d=0):(l=o/(o+d),n.push({date:e[c].testDate,ratio:l,counts:o+d,testName:e[c].testName,passFiles:i,failFiles:r}),i=[],r=[],o=0,d=0,s.push(n),a.push(e[c].testName),n=[]);var u=new Date(Date.parse(d3.min(s,function(e){return d3.extent(e,function(e){return A(new Date(e.date))})[0]}))),h=new Date(Date.parse(d3.max(s,function(e){return d3.extent(e,function(e){return A(new Date(e.date))})[1]}))),p=Math.round((h-u)/1e3/3600/24),f={top:20,right:20,bottom:40,left:100},m=960,g=Math.max(250,60*a.length),y=m-f.left-f.right,v=g-f.top-f.bottom,D=40,b=d3.select("#charts").append("svg").attr("id",t).attr("style","width: "+m+"px; height: "+g+"px;"),w=d3.scaleTime().range([0,y]).domain([u,O(h,1)]),x=d3.scaleBand().range([v,0]).padding(.1).domain(a),R=d3.axisBottom(w);R.tickValues(q(u,O(h,1),Math.round(Math.max(80*p/m,1)))).tickFormat(d3.timeFormat("%m-%d"));var k=d3.axisLeft(x),E=d3.zoom().scaleExtent([1,Math.round(80*p/m)]).translateExtent([[0,0],[y,v]]).extent([[0,0],[y,v]]).on("zoom",function(){var e=d3.select(".tooltip");e.style("opacity",0),(e=d3.select(".testListTip")).style("display","none");var t=b.select(".clicked");!1===t.empty()&&t.attr("class",t.attr("class").split(" ")[0]).style("fill","");var a=d3.event.transform.rescaleX(w);B=T.selectAll(".passBar"),C=T.selectAll(".failBar"),M(B,a,"pass"),M(C,a,"fail"),b.selectAll("rect").filter(function(){var e=this.attributes.transform.value;if(e=e.slice(e.indexOf("(")+1,e.indexOf(",")),(e=parseFloat(e))<99||e>y+100)return[this]}).style("display","none"),b.selectAll("rect").filter(function(){var e=this.attributes.transform.value;if(e=e.slice(e.indexOf("(")+1,e.indexOf(",")),(e=parseFloat(e))>98&&e<y+101)return[this]}).style("display","block"),N.tickValues(q(u,O(h,1),Math.round(Math.max(80*p/m/d3.event.transform.k,1)))),I.call(N.scale(a)),I.selectAll("g").filter(function(){var e=this.attributes.transform.value;if(e=e.slice(e.indexOf("(")+1,e.indexOf(",")),(e=parseFloat(e))<-1||e>y+1)return[this]}).remove(),R.tickValues(q(u,O(h,1),Math.round(Math.max(80*p/m/d3.event.transform.k,1)))),F.call(R.scale(a)),F.selectAll("g").filter(function(){var e=this.attributes.transform.value;if(e=e.slice(e.indexOf("(")+1,e.indexOf(",")),(e=parseFloat(e))<-1||e>y+1)return[this]}).remove()}),T=b.append("g").attr("id","bars"),B=T.selectAll(".passBar"),C=T.selectAll(".failBar");for(c=0;c<s.length;c++)L(B,s[c],"pass"),L(C,s[c],"fail");B=T.selectAll(".passBar"),C=T.selectAll(".failBar"),M(B,w,"pass"),M(C,w,"fail"),S(B,"pass"),S(C,"fail"),d3.selectAll("rect").filter(function(e,t,a){if(0===parseFloat(a[t].getAttribute("width")))return e}).remove();var N=d3.axisTop(w);N.ticks(d3.timeDay.every(Math.round(Math.max(80*p/m,1)))).tickSize(-v).tickFormat("");var I=b.append("g").attr("transform","translate("+f.left+", 0)").attr("class","gridLine");I.call(N);var F=b.append("g").attr("transform","translate("+f.left+","+v+")").attr("class","xAxis");function L(e,t,a){e.data(t).enter().append("rect").attr("class",function(){return"pass"===a?"passBar":"failBar"})}function M(e,t,a){e.attr("width",function(e){return"pass"===a?t(O(A(e.date),e.ratio))-t(A(e.date)):t(O(A(e.date),1-e.ratio))-t(A(e.date))}).attr("transform",function(e){return"pass"===a?"translate("+(f.left+t(A(e.date)))+", 0)":"translate("+(f.left+t(O(A(e.date),e.ratio)))+", 0)"}).attr("height",D).attr("y",function(e){return x(e.testName)+(x.bandwidth()-D)/2})}function S(e,t){e.on("mouseover",function(e){var a=this,n=d3.select(".tooltip");n.transition().duration(300).style("opacity",.9),n.html(function(){var a,n;return"pass"===t?(a=Math.round(e.ratio*e.counts),n=" passed"):(a=Math.round((1-e.ratio)*e.counts),n=" failed"),"<span>"+a+(a>1?" tests":" test")+n+"</span><br>"}).style("left",function(){var e,t=a.getBoundingClientRect().left,n=a.getBoundingClientRect().width,s=this.getBoundingClientRect().width;return isSafari||isEdge?e=document.getElementsByTagName("body")[0].scrollLeft:(isChrome||isFirefox||isIE)&&(e=document.getElementsByTagName("html")[0].scrollLeft),t+n/2-s/2+e+"px"}).style("top",function(){var e,t=a.getBoundingClientRect().top,n=this.getBoundingClientRect().height;return isSafari||isEdge?e=document.getElementsByTagName("body")[0].scrollTop:(isChrome||isFirefox||isIE)&&(e=document.getElementsByTagName("html")[0].scrollTop),e+t-n-10+"px"})}).on("mouseout",function(){d3.select(".tooltip").transition().duration(200).style("opacity",0)}).on("click",function(e){var a=d3.select(this),n=this,s=d3.select(".testListTip");if(a.attr("class").indexOf("clicked")>-1)a.attr("class",a.attr("class").split(" ")[0]),a.attr("style",""),s.style("display","none");else{var i=b.select(".clicked");!1===i.empty()&&i.attr("class",i.attr("class").split(" ")[0]).style("fill",""),a.attr("class",a.attr("class")+" clicked"),a.style("fill",window.getComputedStyle(this).fill),s.html(function(){var a="";if("pass"===t){e.passFiles.length>1?a+="<span>Passed Reports:</span><br>":a+="<span>Passed Report:</span><br>";for(var n=0;n<e.passFiles.length;n++)a+="<span><a href='.\\report\\"+e.passFiles[n]+"' target='_blank'>"+e.passFiles[n]+"</a></span><br>"}else{e.failFiles.length>1?a+="<span>Failed Reports:</span><br>":a+="<span>Failed Report:</span><br>";for(n=0;n<e.failFiles.length;n++)a+="<span><a href='.\\report\\"+e.failFiles[n]+"' target='_blank'>"+e.failFiles[n]+"</a></span><br>"}return a}),s.style("display","block"),s.style("left",function(){for(var e,t,a,s=n.getBoundingClientRect().left,i=n.getBoundingClientRect().width,r=this.getBoundingClientRect().width,l=document.styleSheets,o=0;o<l.length;o++)if(l[o].href.indexOf("main")>-1){t=isFirefox?l[o].cssRules:l[o].rules,o=l.length;for(var d=0;d<t.length;d++)"div.testListTip::after"===t[d].selectorText&&(a=t[d],d=t.length)}return isIE?a.style.margin="-5px 0px 0px -16px":a.style.margin="-5px 0px 0px -"+(r/2+10)+"px",isSafari||isEdge?e=document.getElementsByTagName("body")[0].scrollLeft:(isChrome||isFirefox||isIE)&&(e=document.getElementsByTagName("html")[0].scrollLeft),s+i+e+10+"px"}).style("top",function(){var e,t=n.getBoundingClientRect().top,a=n.getBoundingClientRect().height,s=this.getBoundingClientRect().height;return isSafari||isEdge?e=document.getElementsByTagName("body")[0].scrollTop:(isChrome||isFirefox||isIE)&&(e=document.getElementsByTagName("html")[0].scrollTop),e+t+a/2-s/2+"px"})}})}function O(e,t){var a=new Date(Date.parse(e));return a.setHours(Math.round(24*t-24*t%1)),a.setMinutes(Math.round(24*t%1*60)),a}function A(e){var t=new Date(e);return t=new Date(t.getTime()+6e4*t.getTimezoneOffset())}function q(e,t,a){for(var n=[],s=0;O(e,s)<=t;)n.push(O(e,s)),s+=a;return n}F.call(R).selectAll("text").style("text-anchor","middle"),b.append("g").attr("transform","translate("+f.left+", 0)").attr("class","yAxis").call(k).selectAll("text").attr("class","cateName").style("text-anchor","start").call(function(e,t){e.each(function(){for(var e,a=d3.select(this),n=a.text(),s=(e=n,["/","&","-"].forEach(function(t){var a=new RegExp(t,"g");e=e.replace(a,t+" ")}),e).split(/\s+/),i=a.attr("x"),r=a.attr("y"),l=parseFloat(a.attr("dy")||0),o=a.text(null).append("tspan").attr("x",i).attr("y",r).attr("dy",l+"em"),d=0;d<s.length;d++)s[d]=v(s[d]);for(var c,u,h=(n=s.join(" ")).split(/\s+/).reverse(),p=[],m=0,g=["/","&","-"];c=h.pop();)p.push(c),o.text(p.join(" ")),o.node().getComputedTextLength()>t&&(p.pop(),u=p.join(" "),g.forEach(function(e){u=u.replace(e+" ",e)}),o.text(u),p=[c],o=a.append("tspan").attr("x",i).attr("y",r).attr("dy",1.1*++m+l+"em").text(c));var y=parseInt(window.getComputedStyle(a._groups[0][0]).fontSize.slice(0,-2));function v(e){if(o.text(e),o.node().getComputedTextLength()>t)for(var a=e.split(""),n="",s=0;s<a.length;s++)n+=a[s],o.text(n),o.node().getComputedTextLength()>t&&("-"!==a[s-1]&&(e=e.slice(0,s-1)+"- "+v(e.slice(s-1))),s=a.length);return e}a.attr("transform","translate(-"+(f.left-13)+", -"+m/2*1.1*y+")")})},f.left-12),b.on("click",function(){if("rect"!=d3.event.target.tagName){var e=d3.select(".testListTip"),t=b.select(".clicked");!1===t.empty()&&t.attr("class",t.attr("class").split(" ")[0]).style("fill",""),e.style("display","none")}}),b.call(E),function(e){var t,a=e.height();t=isChrome||isIE?e.get(0).scrollHeight:parseInt(e.height());e.off("mousewheel").on("mousewheel",function(e){var n=this.scrollTop===t-a&&e.deltaY<0||0===this.scrollTop&&e.deltaY>0;return!n})}($("#"+t))}function c(e){var t='<table style="width: 100%; margin: auto" class = "detailTable"><tr><th>Test Name</th><th>Test Date</th><th>Link</th><th>Result</th></tr>';return e.forEach(function(e){var a="<tr><td>"+e.testName+"</td><td>"+g(e.testDate)+'</td><td style="text-overflow: ellipsis;"><a href=\'.\\report\\'+e.fileName+"' target='_blank'>"+e.fileName+"</a></td>",n="<td>";"Pass"===e.testResult?n+='<font color="#31c631"><b>'+e.testResult+"</b></font></td></tr>":n+='<font color="#f75656"><b>'+e.testResult+"</b></font></td></tr>",t+=a+n}),t+="</table>"}function u(e){e.style.opacity="0",e.style.height="0px",window.setTimeout(function(){e.style.display="none"},400)}function h(e){e.style.opacity="1",e.style.height="",window.setTimeout(function(){e.style.display="block"},400)}function p(){onDateRadio.checked?(dateValue.disabled=!1,withinDays.disabled=!0,dateRange1.disabled=!0,dateRange2.disabled=!0):withinDaysRadio.checked?(dateValue.disabled=!0,withinDays.disabled=!1,dateRange1.disabled=!0,dateRange2.disabled=!0):(dateValue.disabled=!0,withinDays.disabled=!0,dateRange1.disabled=!1,dateRange2.disabled=!1),i()}function f(){cateCheck.checked?$("#multi-select").removeClass("disabled"):$("#multi-select").addClass("disabled"),i()}function m(){r(dateRange1.value)&&("date"!=$("#testDate")[0].type?$("#dateRange2").datepicker("option","minDate",new Date(dateRange1.value)):(dateRange2.min=dateRange1.value,new Date(dateRange1.value)>new Date(dateRange2.value)&&(dateRange2.value=dateRange1.value))),i()}function g(e){var t=new Date(e),a=(t=new Date(t.getTime()+6e4*t.getTimezoneOffset())).getDate(),n=t.getMonth()+1;return a<10&&(a="0"+a),n<10&&(n="0"+n),n+"/"+a+"/"+t.getFullYear()}