/*! qadashboard 2018-03-18 by sillicon */

var e=require("express"),r=require("path"),i=require("passport"),t=require("serve-favicon"),u=require("morgan"),n=require("cookie-parser"),s=require("body-parser"),o=require("mongodb").MongoClient,a=require("./lib").Strategy,l=require("./routes/uploadReport"),c=require("./routes/queryReports"),d=require("./routes/getTestName"),p=require("./routes/githubLogin"),g=process.env.deployPath||"";i.use(new a({clientID:"4d3e985fc1a04fdf2674",clientSecret:"022ba1b17ff29735a2afe03e1f8530a50affbeb0",callbackURL:"https://nodereport.herokuapp.com/login/github/return"},function(e,r,i,t){return i.accessToken=e,t(null,i)})),i.serializeUser(function(e,r){r(null,e)}),i.deserializeUser(function(e,r){r(null,e)});var m=e();m.set("views",r.join(__dirname,"views")),m.set("view engine","pug"),m.use(g,t(r.join(__dirname,"public","favicon.ico"))),m.use(u("dev")),m.use(s.json({limit:"50mb"})),m.use(s.urlencoded({limit:"50mb",extended:!1})),m.use(n()),m.use(require("express-session")({secret:"my precious",resave:!0,saveUninitialized:!0})),m.use(i.initialize()),m.use(i.session()),m.use(g,e.static(r.join(__dirname,"public"))),m.use(g,l),m.use(g,c),m.use(g,d),m.use(g,p),m.get(g,function(e,i){i.sendFile(r.join(__dirname,"public","home.html"))}),m.get(g+"/ReadReport",function(e,i){i.sendFile(r.join(__dirname,"public","ReadReport.html"))}),m.get(g+"/UploadReport",function(e,i){i.sendFile(r.join(__dirname,"public","UploadReport.html"))}),m.get(g+"/login/github",i.authenticate("github")),m.get(g+"/login/github/return",i.authenticate("github",{failureRedirect:g+"/"}),function(e,r){r.redirect(g+"/")}),m.use(function(e,r,i){var t=new Error("Page Not Found");t.status=404,i(t)}),m.use(function(e,r,i,t){i.locals.message=e.message,i.locals.error="development"===r.app.get("env")?e:{},i.status(e.status||500),i.render("error")}),module.exports=m;